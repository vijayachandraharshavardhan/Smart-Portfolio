{% extends "projects/base.html" %}
{% load static %}
{% block title %}Projects | Smart Portfolio Site{% endblock %}

{% block content %}
<div class="projects-page">
  <!-- ================= HERO ================= -->
  <div class="projects-hero text-center mb-3 mb-md-4" style="background: linear-gradient(135deg, rgba(26,26,26,0.8) 0%, rgba(45,45,45,0.8) 50%, rgba(58,58,58,0.8) 100%); color: white; padding: 1rem 0.75rem 1.25rem; border-radius: 15px; margin: 0.5rem 0 1.5rem 0; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1);">
    <h1 class="display-4 fw-bold mb-2 mb-md-3" style="text-shadow: 0 0 20px rgba(255,255,255,0.3); font-size: clamp(1.8rem,5vw,3.5rem);">My Projects</h1>
    <p class="text-white-50 small mb-0" style="font-size: clamp(0.8rem,2.5vw,1rem);">A showcase of my best work and technology stack</p>
  </div>

  <div class="container-fluid px-2 px-md-3" style="color: white;">
    <!-- ================= DASHBOARD STATS ================= -->
    <div class="row mb-3 mb-md-4 text-center">
      <div class="col-6 col-sm-6 col-md-3 mb-2 mb-md-3">
        <div class="dashboard-card" style="background: rgba(0,0,0,0.3); backdrop-filter: blur(5px); border-radius:10px; padding:0.75rem; border:1px solid rgba(255,255,255,0.1);">
          <div class="card-body py-2 py-md-3">
            <i class="fas fa-project-diagram fa-lg mb-1 mb-md-2"></i>
            <h5 class="fw-bold mb-0 mb-md-1" style="font-size: clamp(1rem,3vw,1.25rem);">{{ total_projects }}</h5>
            <small style="font-size: clamp(0.7rem,2vw,0.875rem);">Projects</small>
          </div>
        </div>
      </div>
      <div class="col-6 col-sm-6 col-md-3 mb-2 mb-md-3">
        <div class="dashboard-card" style="background: rgba(0,0,0,0.3); backdrop-filter: blur(5px); border-radius:10px; padding:0.75rem; border:1px solid rgba(255,255,255,0.1);">
          <div class="card-body py-2 py-md-3">
            <i class="fas fa-code fa-lg mb-1 mb-md-2"></i>
            <h5 class="fw-bold mb-0 mb-md-1" style="font-size: clamp(1rem,3vw,1.25rem);">{{ tech_stacks|length }}</h5>
            <small style="font-size: clamp(0.7rem,2vw,0.875rem);">Technologies</small>
          </div>
        </div>
      </div>
      <div class="col-6 col-sm-6 col-md-3 mb-2 mb-md-3">
        <div class="dashboard-card" style="background: rgba(0,0,0,0.3); backdrop-filter: blur(5px); border-radius:10px; padding:0.75rem; border:1px solid rgba(255,255,255,0.1);">
          <div class="card-body py-2 py-md-3">
            <i class="fas fa-calendar-alt fa-lg mb-1 mb-md-2"></i>
            <h5 class="fw-bold mb-0 mb-md-1" style="font-size: clamp(1rem,3vw,1.25rem);">{{ projects|length|add:0 }}</h5>
            <small style="font-size: clamp(0.7rem,2vw,0.875rem);">Active</small>
          </div>
        </div>
      </div>
      <div class="col-6 col-sm-6 col-md-3 mb-2 mb-md-3">
        <div class="dashboard-card" style="background: rgba(0,0,0,0.3); backdrop-filter: blur(5px); border-radius:10px; padding:0.75rem; border:1px solid rgba(255,255,255,0.1);">
          <div class="card-body py-2 py-md-3">
            <i class="fas fa-star fa-lg mb-1 mb-md-2"></i>
            <h5 class="fw-bold mb-0 mb-md-1" style="font-size: clamp(1rem,3vw,1.25rem);">{{ projects|length|add:0 }}</h5>
            <small style="font-size: clamp(0.7rem,2vw,0.875rem);">Featured</small>
          </div>
        </div>
      </div>
    </div>

    <!-- ================= SEARCH + FILTER ================= -->
    <div class="row align-items-center mb-3 mb-md-4">
      <div class="col-12 col-lg-9 mb-2 mb-md-3">
        <div class="search-container" style="background: rgba(0,0,0,0.2); backdrop-filter: blur(5px); border-radius:8px; padding:0.5rem 1rem; border:1px solid rgba(255,255,255,0.1);">
          <input type="text" id="projectSearch" class="form-control form-control-sm" placeholder="Search projects..." style="background: transparent; border: none; color: white; font-size: clamp(0.875rem,2vw,1rem);">
        </div>
      </div>
      <div class="col-12 col-lg-3 mb-2 mb-md-3 text-lg-end">
        <div class="filter-buttons" style="background: rgba(0,0,0,0.2); backdrop-filter: blur(5px); border-radius:8px; padding:0.5rem; display:flex; flex-wrap:wrap; gap:0.25rem 0.5rem; justify-content:center;">
          <button class="btn btn-outline-secondary filter-btn btn-sm active" data-filter="all" style="font-size: clamp(0.75rem,1.5vw,0.875rem);">All</button>
          {% for tech in tech_stacks %}
          <button class="btn btn-outline-secondary filter-btn btn-sm" data-filter="{{ tech }}" style="font-size: clamp(0.75rem,1.5vw,0.875rem);">{{ tech }}</button>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- ================= PROJECTS GRID ================= -->
    <div class="row g-3" id="projectsGrid">
      {% for project in projects %}
      <div class="col-12 col-sm-6 col-lg-4 col-xl-3 project-item" data-tech="{{ project.tech_stack|lower }}">
        <div class="project-card d-flex flex-column h-100 position-relative" data-bs-toggle="modal" data-bs-target="#projectModal{{ project.id }}">
          <div class="card-img-container flex-shrink-0">
            {% if project.image %}
              <img src="{{ project.image.url }}" class="img-fluid w-100 h-100 object-fit-cover" alt="{{ project.title }}">
            {% elif project.video %}
              <video class="img-fluid w-100 h-100 object-fit-cover" autoplay muted loop playsinline>
                <source src="{{ project.video.url }}" type="video/mp4">
              </video>
            {% else %}
              <div class="no-video-placeholder d-flex align-items-center justify-content-center h-100 w-100">
                <i class="fas fa-image fa-3x text-muted"></i>
              </div>
            {% endif %}
          </div>
          <div class="card-body d-flex flex-column flex-grow-1 p-2 p-sm-3">
            <h6 class="card-title fw-bold mb-1 mb-md-2" style="font-size: clamp(0.9rem,2.5vw,1.1rem);">{{ project.title }}</h6>
            <p class="card-text small mb-2 mb-md-3" style="font-size: clamp(0.75rem,2vw,0.875rem);">{{ project.description|truncatewords:15 }}</p>
            <div class="tech-badges mt-auto">
              {% for tech in project.tech_stack_list %}
              <span class="badge bg-secondary" style="font-size: clamp(0.65rem,1.5vw,0.75rem); padding:0.2rem 0.4rem;">{{ tech }}</span>
              {% endfor %}
            </div>
          </div>
          <button class="view-btn btn-sm position-absolute bottom-0 end-0 m-2">
            <i class="fas fa-eye me-1"></i>View
          </button>
        </div>
      </div>
      {% empty %}
      <div class="col-12 text-center py-4 py-md-5">
        <i class="fas fa-code fa-4x text-muted mb-3 mb-md-4"></i>
        <h5 class="text-muted fw-bold" style="font-size: clamp(1.1rem,3vw,1.5rem);">No projects yet</h5>
        <p class="text-muted" style="font-size: clamp(0.875rem,2.5vw,1rem);">Add some projects in Django admin to display them here.</p>
      </div>
      {% endfor %}
    </div>
  </div>
</div>

<!-- ================= MODALS ================= -->
{% for project in projects %}
<div class="modal fade" id="projectModal{{ project.id }}" tabindex="-1" aria-labelledby="projectModalLabel{{ project.id }}" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title fw-bold">{{ project.title }}</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-12 col-md-6 mb-3 mb-md-0">
            {% if project.image %}
            <img src="{{ project.image.url }}" class="img-fluid rounded" alt="{{ project.title }}">
            {% elif project.video %}
            <video class="img-fluid rounded" controls>
              <source src="{{ project.video.url }}" type="video/mp4">
            </video>
            {% else %}
            <div class="no-video-placeholder-modal text-center py-4 py-md-5">
              <i class="fas fa-image fa-3x text-muted"></i>
              <p class="text-muted mt-2">No media available</p>
            </div>
            {% endif %}
          </div>
          <div class="col-12 col-md-6 d-flex flex-column">
            <p class="text-muted small mb-3"><i class="fas fa-calendar-alt me-1"></i>{{ project.created_at|date:"F Y" }}</p>
            <p class="mb-3 mb-md-4">{{ project.description }}</p>
            <h6 class="fw-bold mb-2 mb-md-3"><i class="fas fa-code me-1"></i>Technologies Used:</h6>
            <div class="tech-badges mb-3 mb-md-4">
              {% for tech in project.tech_stack_list %}
              <span class="badge bg-secondary">{{ tech }}</span>
              {% endfor %}
            </div>
            <div class="mt-auto text-end">
              <div class="d-flex flex-column flex-sm-row gap-2 justify-content-end">
                {% if project.live_demo %}
                <a href="{{ project.live_demo }}" target="_blank" class="btn btn-primary"><i class="fas fa-external-link-alt me-1"></i>Live Demo</a>
                {% endif %}
                {% if project.github_link %}
                <a href="{{ project.github_link }}" target="_blank" class="btn btn-dark"><i class="fab fa-github me-1"></i>GitHub</a>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endfor %}

<!-- ================= SCRIPTS ================= -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const searchInput = document.getElementById('projectSearch');
  const projectItems = document.querySelectorAll('.project-item');
  const filterButtons = document.querySelectorAll('.filter-btn');
  const projectCards = document.querySelectorAll('.project-card');

  // Search and filter
  function filterProjects() {
    const searchTerm = searchInput.value.toLowerCase();
    const activeFilter = document.querySelector('.filter-btn.active').getAttribute('data-filter');
    projectItems.forEach(item => {
      const title = item.querySelector('.card-title').textContent.toLowerCase();
      const desc = item.querySelector('.card-text').textContent.toLowerCase();
      const tech = item.getAttribute('data-tech');
      const matchSearch = title.includes(searchTerm) || desc.includes(searchTerm);
      const matchFilter = activeFilter === 'all' || tech.includes(activeFilter.toLowerCase());
      item.style.display = (matchSearch && matchFilter) ? 'block' : 'none';
    });
  }
  searchInput.addEventListener('input', filterProjects);
  filterButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      filterButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      filterProjects();
    });
  });

  // Video autoplay in modals
  document.addEventListener('shown.bs.modal', function(event) {
    const video = event.target.querySelector('video');
    if(video) video.play();
  });
  document.addEventListener('hidden.bs.modal', function(event) {
    const video = event.target.querySelector('video');
    if(video) {
      video.pause();
      video.currentTime = 0;
    }
  });
});
</script>

<style>
.project-card {
  border-radius: 10px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  background: rgba(0,0,0,0.25);
  backdrop-filter: blur(5px);
  position: relative;
}
.card-img-container {
  height: 200px;
  overflow: hidden;
}
.object-fit-cover {
  object-fit: cover;
  width: 100%;
  height: 100%;
}
.view-btn {
  font-size: clamp(0.75rem,1.8vw,0.875rem);
  padding: 0.375rem 0.75rem;
  background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  border: none;
  color: white;
  border-radius: 20px;
  box-shadow: 0 4px 15px rgba(102,126,234,0.4);
  font-weight: 600;
  z-index: 10;
}
.no-video-placeholder {
  min-height: 200px;
  display: flex;
  align-items: center;
  justify-content: center;
}
@media (hover: none) {
  .project-card video {
    opacity: 1 !important;
  }
}
</style>
{% endblock %}
